# 后台开发日志

## 21.09.29 ~ 21.10.03

这几天一直在研究SpringSecurity配合鉴权，以及使用vue-element-template搭建后台系统，无果。

转而开始使用sa-token鉴权，效果不错，算是刚刚起步吧

## 21.10.04

前后端交互就用token认证，把token塞进请求头header中 Authorization : tokenValue

#### 问题待解决

xyz.dg.dgpethome.config.SaTokenConfigure下角色认证有问题，怀疑是因为写了/admin/*导致，因为我的登录叫/admin/login导致后续也被识别到，出现了**在请求登录接口的时候就报token未认证异常 **,暂时注释掉，之后再弄好点。

```java
 SaRouter.match(Arrays.asList("/**"), Arrays.asList("/admin/login"), () -> StpUtil.checkLogin());
//SaRouter.match("/admin/**", () -> StpUtil.checkRoleOr("20", "21"));
```

#### 问题已解决

晚上一直在尝试用后台管理系统的GET请求方式给后端发 类似于下面这种对象数据，但发送的请求会变成userVo[userName]的形式在url上无法识别, 用Post请求在后台用@RequestBody倒是能实现，但违背了我想用GET请求的方式

```vue
params:{
    // 搜索框表单数据
	userVo: {
		userName: ''
	}, 
    currentPage: 1,
    pageSize: 10,
    totalNum: 0
}
```

无论是JSON.stringify()去转还是用qs.stringify()实现都无果 ， 搜索了网上案例都不能很好实现，遂放弃转而只传值，不搞非主流的传对象

#### 对象的分页数据包装

原先从数据库取数据总是包含了不必要的字段，故包装了一下需要的字段，但在用Mybatis-plus的分页的时候又不想搞的太复杂,只想实现简单的Ipage<SysUser> -> Ipage<SysUserVo>,查了下可以用hutool的core包下的BeanUtil来解决

```java
this.baseMapper.selectPage(userPage,queryWrapper)
.convert(item-> BeanUtil.copyProperties(item,SysUserVo.class))
```

### 21.10.07

将原先本来用mybatis-plus的分页查询改成了自己的，方便多表查询

```java
IPage<SysUserVo> userVoIPage = new Page<>();
userVoIPage.setPages(sysUserPageParam.getPageSize());
userVoIPage.setCurrent(sysUserPageParam.getCurrentPage());

List<SysUserVo> list = sysUserMapper.findUserList(sysUserPageParam);
System.out.println(list.toString());
userVoIPage.setRecords(list);
```

```sql
 <select id="findUserList" resultMap="BaseResultMap_Vo"  parameterType="xyz.dg.dgpethome.model.page.SysUserPageParam">
    SELECT
      <include refid="Base_Column_List_Vo" />
      FROM `sys_dict` d1
      join `sys_user` u on u.user_role_id = d1.dict_id
        <where>
            d1.dict_parent_id = #{sysUserPageParam.dictParentId}
            and
            u.user_name LIKE concat('%',#{sysUserPageParam.userName,jdbcType=VARCHAR},'%')
        </where>
    </select>
```

### 21.10.08

修复了使用limit分页前端错误显示的错误，以及使用了自定义的分页(查全部再在impl进行分页返回)

```java
List<SysUserVo> totalList = sysUserMapper.findUserList(sysUserPageParam);
        //开始
        Long front = (sysUserPageParam.getCurrentPage()-1)*sysUserPageParam.getPageSize();
        //结尾
        Long end = Math.min(sysUserPageParam.getCurrentPage()*sysUserPageParam.getPageSize(),totalList.size());
        List<SysUserVo> limitList = totalList.subList(front.intValue(),end.intValue());
        System.out.println(limitList.toString());
        userVoIPage.setRecords(limitList);
        userVoIPage.setTotal(totalList.size());
```

